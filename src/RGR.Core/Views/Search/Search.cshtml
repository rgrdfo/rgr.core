
@using RGR.Core.Common.Enums;
@using RGR.Core.Views.Helpers;

@using Newtonsoft.Json;
@using Microsoft.AspNetCore.Html;
@using System.Text;

@{
    ViewData["Title"] = "Результаты поиска";
}

@{
    var objects = SearchResult.Deserialize((string)ViewData["Result"]);
}

<head>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
    <!--<script src="~/js/map.js" type="text/javascript"></script>-->
    <script type="text/javascript">
        ymaps.ready(init);
        var myMap,
            myPlacemark;

        function init() {
            myMap = new ymaps.Map("search-result-map", {
                center: [48.48888324, 135.08322577],
                zoom: 12
            });

            //myPlacemark = new ymaps.Placemark([48.48888324, 135.08322577], {
            //    hintContent: 'РГР ДФО',
            //    balloonContent: 'ул. Карла Маркса, 65-102А'
            //});

            //myMap.geoObjects.add(myPlacemark);           
        }

        function drawPlacemark(latitude, longitude, address) {
            map.removeAllOverlays();
            myPlacemark = new ymaps.Placemark([latitude, longitude], {                
                balloonContent: address,
                center: [latitude, longitude]
            });
            myMap.geoObjects.add(myPlacemark);           

        }        

        function findLocation(str) {
            var geocoder = ymaps.geocode(str);
            geocoder.Then(
                function (res) {
                    map.geoObjects.add(res.geoObjects)
                    throw (":)");
                },
                    function (err) {
                        throw ":(";
                    }
                    );
        }
    </script>
    

    <link rel="stylesheet" href="~/js/quickbox/qb/qb.css">
    <script type="text/javascript" src="~/js/quickbox/qb/js/qb.js"></script>
</head>

<div class="search-bar">
    @SearchBar.Render()
</div>
<div class="content-inner">
    <div id="result-search">
        <h4>Показать: </h4>
        <ul id="search-objects-tabs" class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#searchType1">На карте</a></li>
            <li><a data-toggle="tab" href="#searchType2">Список</a></li>
        </ul>
        <div class="tab-content">
            <div id="searchType1" class="tab-pane  in active">
                <div class="search-result-row-md">
                    @await Component.InvokeAsync("SearchResultMap", new { Result = objects, OrderingField = "Price" })
                </div>
                <div class="search-result-row-md">
                    <div id="search-result-map"></div>
                </div>
            </div>
            <div id="searchType2" class="tab-pane">
                @*Отладочная информация, убрать к релизу
                    <font size="1">@ViewData["Timer"] </font> <br /> <br />

                    <a href='@url.action("saverequest", "search")'> сохранить запрос </a>
                    <form action="saveRequest">
                        <input name="query" value="@Context.Request.QueryString.ToString()" hidden="hidden" />
                        <input type="submit" value="Сохранить запрос" />
                    </form>*@
                <div class="search-result-box">
                    @SearchResult.HeadResult((EstateTypes)ViewData["Type"])
                    @await Component.InvokeAsync("SearchResultRenderer", new { Result = objects, Type = ViewData["Type"], OrderingField = "Price" })
                </div>
            </div>
        </div>
    </div>
</div>





